---
title: "Sequence DiyagramÄ± 2: Ders Ã‡alÄ±ÅŸma ve Quiz AkÄ±ÅŸÄ±"
---
sequenceDiagram
    actor User as KullanÄ±cÄ±
    participant Home as HomePage
    participant Roadmap as RoadmapView
    participant Learning as LearningView
    participant Quiz as QuizRunner
    participant API as QuizAPI<br/>(/api/quiz)
    participant DB as quizzes.json
    participant LS as localStorage

    Note over User,LS: Ders (Lesson) AkÄ±ÅŸÄ±

    User->>Roadmap: Ders node'una tÄ±kla (type=lesson)
    Roadmap->>Home: onNodeClick(nodeId)
    Home->>Home: activeLesson = node.content<br/>view = 'lesson'
    Home->>Learning: Render LearningView(title, content)
    Learning->>User: Markdown iÃ§eriÄŸi gÃ¶ster<br/>(metin, kod Ã¶rnekleri, aÃ§Ä±klamalar)

    User->>Learning: "Dersi Tamamla" butonuna tÄ±kla
    Learning->>Home: onComplete()

    Home->>LS: storage.completeNode(nodeId, false)
    LS->>LS: completedNodes.push(nodeId)<br/>xp += 10 + streak_bonus<br/>streak gÃ¼ncelle
    LS-->>Home: {xpGained: 15, newAchievements: []}

    Home->>User: "+15 XP" animasyonu<br/>Node tamamlandÄ± âœ“

    Note over User,LS: Quiz AkÄ±ÅŸÄ±

    User->>Roadmap: Quiz node'una tÄ±kla (type=quiz)
    Roadmap->>Home: onNodeClick(nodeId)
    Home->>API: GET /api/quiz/{nodeId}
    API->>DB: quizzes.json oku
    DB-->>API: Soru listesi
    API->>API: SorularÄ± karÄ±ÅŸtÄ±r (shuffle)
    API-->>Home: {questions: Question[]}

    Home->>Quiz: Render QuizRunner(questions)
    Quiz->>User: Ä°lk soru + 3 can â™¥â™¥â™¥

    loop Her soru iÃ§in
        User->>Quiz: Cevap seÃ§
        alt DoÄŸru Cevap
            Quiz->>User: âœ“ DoÄŸru! (yeÅŸil animasyon)
        else YanlÄ±ÅŸ Cevap
            Quiz->>Quiz: hearts--
            Quiz->>User: âœ— YanlÄ±ÅŸ! AÃ§Ä±klama gÃ¶ster
            alt hearts == 0
                Quiz->>Quiz: Quiz baÅŸarÄ±sÄ±z - break
            end
        end
    end

    Quiz->>Quiz: QuizResult hesapla

    alt BaÅŸarÄ±lÄ± (>=%70)
        Quiz->>User: "Tebrikler!" ğŸŠ Konfeti
        User->>Quiz: "Devam" tÄ±kla
        Quiz->>Home: onComplete(result)
        Home->>LS: storage.completeNode(nodeId, true, score)
        LS->>LS: xp += 25 (veya 40 perfect)<br/>quizAttempt kaydet<br/>achievement kontrol
        LS-->>Home: {xpGained: 30, newAchievements}
        Home->>User: "+30 XP" animasyonu
    else BaÅŸarÄ±sÄ±z (<%70)
        Quiz->>User: "Tekrar Dene" gÃ¶ster
        User->>Quiz: "Devam" tÄ±kla
        Quiz->>Home: onComplete(result)
        Home->>LS: storage.addQuizAttempt(nodeId, score, false)
    end

    Home->>Home: view = 'dashboard'
    Home->>User: Dashboard'a dÃ¶n

@startuml Sequence_LessonAndQuiz

title KariyerYolu AI - Sequence DiyagramÄ± 2: Ders Ã‡alÄ±ÅŸma ve Quiz AkÄ±ÅŸÄ±

skinparam sequence {
    ArrowColor #333333
    LifeLineBorderColor #1565C0
    LifeLineBackgroundColor #E3F2FD
    ParticipantBorderColor #1565C0
    ParticipantBackgroundColor #E3F2FD
    ActorBorderColor #2E7D32
    ActorBackgroundColor #E8F5E9
}

actor "KullanÄ±cÄ±" as User
participant "HomePage" as Home
participant "RoadmapView" as Roadmap
participant "LearningView" as Learning
participant "QuizRunner" as Quiz
participant "QuizAPI\n(/api/quiz)" as QuizAPI
database "quizzes.json" as QDB
database "localStorage" as LS

== Roadmap GÃ¶rÃ¼ntÃ¼leme ==

User -> Home : Dashboard'a git
activate Home

Home -> Roadmap : Render RoadmapView\n(units, userProgress)
activate Roadmap

Roadmap -> User : Roadmap GÃ¶ster\n(Ã¼nite bazlÄ± node'lar:\nlesson/quiz/boss)

== Ders (Lesson) AkÄ±ÅŸÄ± ==

User -> Roadmap : Ders Node'una TÄ±kla\n(type = 'lesson')
Roadmap -> Home : onNodeClick(nodeId)

Home -> Home : activeLesson = node.content\nview = 'lesson'

Home -> Learning : Render LearningView\n(title, content)
activate Learning
deactivate Roadmap

Learning -> User : Markdown Ä°Ã§eriÄŸi GÃ¶ster\n(Ders metni, kod Ã¶rnekleri,\naÃ§Ä±klamalar)

User -> Learning : "Dersi Tamamla" butonuna tÄ±kla
Learning -> Home : onComplete()
deactivate Learning

Home -> LS : storage.completeNode(nodeId, false)
activate LS
LS -> LS : completedNodes.push(nodeId)\nxp += 10 (LESSON_COMPLETE)\nstreak kontrolÃ¼ ve gÃ¼ncelleme\nachievement kontrolÃ¼
LS --> Home : { xpGained: 15,\nnewAchievements: [] }
deactivate LS

Home -> Home : showXPGain = 15\nXPGain animasyonu oynat
Home -> User : "+15 XP" animasyonu\nRoadmap'e geri dÃ¶n\n(node yeÅŸil/tamamlandÄ±)

== Quiz AkÄ±ÅŸÄ± ==

Home -> Roadmap : Render RoadmapView (gÃ¼nceli)
activate Roadmap

User -> Roadmap : Quiz Node'una TÄ±kla\n(type = 'quiz')
Roadmap -> Home : onNodeClick(nodeId)
deactivate Roadmap

Home -> QuizAPI : GET /api/quiz/{nodeId}
activate QuizAPI

QuizAPI -> QDB : quizzes.json oku
activate QDB
QDB --> QuizAPI : Soru listesi
deactivate QDB

QuizAPI -> QuizAPI : SorularÄ± karÄ±ÅŸtÄ±r (shuffle)
QuizAPI --> Home : { questions: Question[] }
deactivate QuizAPI

Home -> Home : view = 'quiz'
Home -> Quiz : Render QuizRunner\n(questions, quizTitle)
activate Quiz

== Quiz Ã‡Ã¶zme SÃ¼reci ==

Quiz -> User : Ä°lk soruyu gÃ¶ster\n(4 seÃ§enek, 3 can â™¥â™¥â™¥)

loop Her soru iÃ§in
    User -> Quiz : Cevap seÃ§
    Quiz -> Quiz : DoÄŸru mu kontrol et

    alt DoÄŸru Cevap
        Quiz -> Quiz : correctAnswers++
        Quiz -> User : âœ“ DoÄŸru! (yeÅŸil animasyon)
    else YanlÄ±ÅŸ Cevap
        Quiz -> Quiz : hearts--\nwrongAnswers++
        Quiz -> User : âœ— YanlÄ±ÅŸ! (kÄ±rmÄ±zÄ± animasyon)\nDoÄŸru cevabÄ± aÃ§Ä±kla

        alt hearts == 0
            Quiz -> Quiz : Quiz baÅŸarÄ±sÄ±z\nbreak
        end
    end

    Quiz -> Quiz : currentQuestion++
end

== Quiz Sonucu ==

Quiz -> Quiz : QuizResult hesapla\n{totalQuestions, correctAnswers,\nwrongAnswers, passed}

alt BaÅŸarÄ±lÄ± (>= %70)
    Quiz -> User : "Tebrikler! BaÅŸarÄ±lÄ±!"\nğŸŠ Konfeti animasyonu\nSkor ve XP gÃ¶ster
else BaÅŸarÄ±sÄ±z (< %70)
    Quiz -> User : "Tekrar Dene"\nSkor gÃ¶ster
end

User -> Quiz : "Devam" butonuna tÄ±kla
Quiz -> Home : onComplete(result)
deactivate Quiz

alt Quiz BaÅŸarÄ±lÄ±
    Home -> LS : storage.completeNode(nodeId, true, score)
    activate LS
    LS -> LS : completedNodes.push(nodeId)\nxp += 25 veya 40 (perfect)\nquizAttempt kaydet\ntotalQuizzesPassed++\nachievement kontrolÃ¼

    alt MÃ¼kemmel Skor (%100)
        LS -> LS : Rozet kontrol: 'perfect_quiz'
    end
    alt 10 Quiz GeÃ§ildi
        LS -> LS : Rozet kontrol: 'quiz_master'
    end

    LS --> Home : { xpGained: 30,\nnewAchievements: ['perfect_quiz'] }
    deactivate LS

    Home -> Home : showXPGain = 30

    opt Yeni Rozet KazanÄ±ldÄ±
        Home -> User : AchievementPopup gÃ¶ster\n"Kusursuz! ğŸ’¯"
    end
else Quiz BaÅŸarÄ±sÄ±z
    Home -> LS : storage.addQuizAttempt(nodeId, score, false)
    activate LS
    LS --> Home : OK
    deactivate LS
end

Home -> Home : view = 'dashboard'
Home -> User : Dashboard'a dÃ¶n\n(gÃ¼ncel ilerleme ile)
deactivate Home

@enduml

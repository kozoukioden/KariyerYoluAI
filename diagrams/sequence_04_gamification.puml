@startuml Sequence_Gamification

title KariyerYolu AI - Sequence DiyagramÄ± 4: OyunlaÅŸtÄ±rma ve Ä°lerleme Sistemi

skinparam sequence {
    ArrowColor #333333
    LifeLineBorderColor #1565C0
    LifeLineBackgroundColor #E3F2FD
    ParticipantBorderColor #1565C0
    ParticipantBackgroundColor #E3F2FD
    ActorBorderColor #2E7D32
    ActorBackgroundColor #E8F5E9
}

actor "KullanÄ±cÄ±" as User
participant "HomePage" as Home
participant "Gamification\nComponents" as Gam
participant "Storage\n(lib/storage.ts)" as Storage
database "localStorage" as LS

== Uygulama YÃ¼klenme - Veri Okuma ==

User -> Home : UygulamayÄ± aÃ§
activate Home

Home -> Storage : storage.load()
activate Storage
Storage -> LS : localStorage.getItem('kariyeryolu_data')
activate LS
LS --> Storage : JSON string
deactivate LS
Storage -> Storage : JSON.parse(data)\nExpiryDate kontrolÃ¼\nStreak sÄ±fÄ±rlama kontrolÃ¼
Storage --> Home : UserData\n{xp: 250, level: 3, streak: 5,\nachievements: [...]}
deactivate Storage

Home -> Gam : Render:\nStatsBar(xp=250, streak=5)\nLevelBadge(xp=250)\nXPCounter(xp=250)\nStreakFlame(streak=5)
activate Gam
Gam -> User : Ãœst bar: âš¡250 XP | ğŸ”¥5 GÃ¼n | Lvl 3 Kalfa
deactivate Gam

== Node Tamamlama - XP Kazanma ==

User -> Home : Ders tamamla (node: fe_u2_n3)

Home -> Storage : storage.completeNode('fe_u2_n3', false)
activate Storage

Storage -> Storage : 1. completedNodes.push('fe_u2_n3')
Storage -> Storage : 2. XP Hesaplama:\n   base = 10 (LESSON_COMPLETE)\n   streak_bonus = 5 Ã— 5 = 25\n   total = 35 XP
Storage -> Storage : 3. xp = 250 + 35 = 285
Storage -> Storage : 4. totalLessonsCompleted++

Storage -> Storage : 5. Streak KontrolÃ¼:\n   lastActivityDate != today?\n   streak++ (5 â†’ 6)\n   lastActivityDate = today

Storage -> Storage : 6. Seviye KontrolÃ¼:\n   285 XP â†’ Level 3 (Kalfa)\n   300 XP'de Level 3 â†’ evet\n   HenÃ¼z seviye atlamadÄ±

Storage -> Storage : 7. Achievement KontrolÃ¼:
note right of Storage
  first_step: âœ“ (zaten kazanÄ±lmÄ±ÅŸ)
  fast_learner: 1 gÃ¼nde 5 ders? â†’ kontrol et
  night_owl: saat > 00:00? â†’ kontrol et
  streak_7: streak >= 7? â†’ hayÄ±r (6)
  quiz_master: 10 quiz? â†’ N/A (ders)
end note

Storage -> LS : localStorage.setItem(\n'kariyeryolu_data', JSON.stringify(userData))
activate LS
LS --> Storage : OK
deactivate LS

Storage --> Home : { xpGained: 35,\nnewAchievements: [] }
deactivate Storage

Home -> Gam : XPGain(amount=35)
activate Gam
Gam -> User : "+35 XP" yÃ¼zen animasyon â¬†ï¸
Gam -> Gam : 2 saniye sonra kaybol
Gam -> User : StatsBar gÃ¼ncelle:\nâš¡285 XP | ğŸ”¥6 GÃ¼n
deactivate Gam

== Seviye Atlama Senaryosu ==

User -> Home : Bir ders daha tamamla

Home -> Storage : storage.completeNode('fe_u2_n4', false)
activate Storage
Storage -> Storage : xp = 285 + 35 = 320\n320 >= 300 â†’ Level 3 â†’ 4!\ncalculateLevel(320) = 4
Storage -> Storage : level = 4 (Uzman ğŸ“)
Storage --> Home : { xpGained: 35,\nnewAchievements: [] }
deactivate Storage

Home -> Gam : XPGain(35)\nLevelBadge(xp=320)
activate Gam
Gam -> User : "+35 XP" animasyonu\nSeviye gÃ¼ncellendi: Lvl 4 Uzman
deactivate Gam

== Rozet Kazanma Senaryosu ==

User -> Home : Quiz'den %100 al

Home -> Storage : storage.completeNode('fe_u2_n5', true, 100)
activate Storage
Storage -> Storage : xp += 40 (QUIZ_PERFECT)\n+ streak_bonus
Storage -> Storage : Achievement kontrolÃ¼:\nperfect_quiz â†’ %100 skor â†’ KAZANILDI!

Storage -> Storage : unlockAchievement('perfect_quiz')\nachievements.push({\n  id: 'perfect_quiz',\n  name: 'Kusursuz',\n  icon: 'ğŸ’¯',\n  earnedAt: now()\n})

Storage --> Home : { xpGained: 70,\nnewAchievements: [\n  {id: 'perfect_quiz',\n   name: 'Kusursuz'}\n]}
deactivate Storage

Home -> Gam : XPGain(70)
activate Gam
Gam -> User : "+70 XP" animasyonu
deactivate Gam

Home -> Gam : AchievementPopup(\nachievementId='perfect_quiz',\nisOpen=true)
activate Gam
Gam -> User : ğŸ‰ Rozet KazandÄ±nÄ±z!\n"Kusursuz ğŸ’¯"\n"Bir quizden tam puan al"
User -> Gam : "Harika!" butonuna tÄ±kla
Gam -> Home : onClose()
deactivate Gam

== Profil GÃ¶rÃ¼ntÃ¼leme ==

User -> Home : Profil menÃ¼sÃ¼ne tÄ±kla
Home -> Home : view = 'profile'

Home -> Storage : storage.getStats()
activate Storage
Storage --> Home : UserStats\n{xp: 390, level: 4,\nstreak: 6, longestStreak: 6,\ntotalLessonsCompleted: 12,\ntotalQuizzesPassed: 3}
deactivate Storage

Home -> Storage : storage.getAchievements()
activate Storage
Storage --> Home : Achievement[]\n[{id: 'first_step'}, {id: 'perfect_quiz'}]
deactivate Storage

Home -> User : Profil SayfasÄ±:\nâ”Œâ”€ StatCard: âš¡390 XP\nâ”œâ”€ StatCard: ğŸ”¥6 GÃ¼n Streak\nâ”œâ”€ StatCard: ğŸ“š12 Ders\nâ”œâ”€ StatCard: âœ…3 Quiz\nâ”œâ”€ LevelCard: Lvl 4 Uzman\nâ””â”€ AchievementsList:\n   âœ… Ä°lk AdÄ±m\n   âœ… Kusursuz\n   ğŸ”’ TutarlÄ± (7 gÃ¼n streak)\n   ğŸ”’ Quiz UstasÄ± (10 quiz)\n   ...

deactivate Home

@enduml

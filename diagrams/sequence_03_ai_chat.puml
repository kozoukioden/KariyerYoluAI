@startuml Sequence_AIChat

title KariyerYolu AI - Sequence DiyagramÄ± 3: AI Mentor Chatbot AkÄ±ÅŸÄ±

skinparam sequence {
    ArrowColor #333333
    LifeLineBorderColor #1565C0
    LifeLineBackgroundColor #E3F2FD
    ParticipantBorderColor #1565C0
    ParticipantBackgroundColor #E3F2FD
    ActorBorderColor #2E7D32
    ActorBackgroundColor #E8F5E9
}

actor "KullanÄ±cÄ±" as User
participant "ChatWidget" as Chat
participant "ChatAPI\n(/api/chat)" as API
database "tracks.json\n(RAG Bilgi TabanÄ±)" as DB
participant "Groq API\n(Llama 3.3 70B)" as Groq

== Chat BaÅŸlatma ==

User -> Chat : Chat ikonuna tÄ±kla
activate Chat
Chat -> Chat : isOpen = true
Chat -> User : Chat penceresi aÃ§\nHoÅŸgeldin mesajÄ± gÃ¶ster\nHÄ±zlÄ± soru butonlarÄ± gÃ¶ster\n("Bu konuyu aÃ§Ä±kla",\n"NasÄ±l Ã¶ÄŸrenmeliyim?", ...)

== Mesaj GÃ¶nderme ==

User -> Chat : Soru yaz ve gÃ¶nder\n"React hooks nedir?"
Chat -> Chat : messages.push({role: 'user',\ncontent: 'React hooks nedir?'})
Chat -> Chat : isLoading = true
Chat -> User : YÃ¼kleniyor animasyonu

Chat -> API : POST /api/chat\n{message: "React hooks nedir?",\nhistory: [...Ã¶nceki mesajlar],\ncurrent_track_id: "frontend_developer"}
activate API

== RAG (Retrieval-Augmented Generation) ==

API -> DB : tracks.json oku
activate DB
DB --> API : TÃ¼m track verileri\n(15 track, 200+ ders)
deactivate DB

API -> API : RAG Arama:\n1. KullanÄ±cÄ± sorusunu analiz et\n2. TÃ¼m ders iÃ§eriklerinde\n   anahtar kelime ara\n3. EÅŸleÅŸen iÃ§erikleri bul\n4. current_track_id'ye\n   Ã¶ncelik ver

API -> API : context[] = [\n  {title: "React Hooks", trackId: "fe"},\n  {title: "State YÃ¶netimi", trackId: "fe"}\n]

== Groq AI Ã‡aÄŸrÄ±sÄ± ==

API -> Groq : POST /openai/v1/chat/completions\n{\n  model: "llama-3.3-70b-versatile",\n  messages: [\n    {role: "system", content:\n     "Sen KariyerYolu AI mentorsun.\n      TÃ¼rkÃ§e cevap ver.\n      Ä°lgili ders iÃ§eriÄŸi: [RAG context]"},\n    ...history,\n    {role: "user", content: "React hooks nedir?"}\n  ],\n  temperature: 0.7,\n  max_tokens: 1024\n}
activate Groq

Groq -> Groq : LLM Ä°ÅŸleme:\nContext + Soru â†’ Cevap Ãœretimi
Groq --> API : {choices: [{message:\n{content: "React Hooks, fonksiyon\ncomponentlerinde state ve\nlifecycle Ã¶zellikleri...\n\n```jsx\nconst [count, setCount] =\n  useState(0);\n```\n..."}}]}
deactivate Groq

API --> Chat : ChatResponse\n{reply: "React Hooks, fonksiyon...",\nsource: "rag",\ncontext: [{title: "React Hooks",\ntrackId: "frontend_developer"}]}
deactivate API

== Cevap GÃ¶sterimi ==

Chat -> Chat : isLoading = false\nmessages.push({role: 'assistant',\ncontent: response.reply,\nsource: 'rag'})
Chat -> User : AI cevabÄ±nÄ± gÃ¶ster\n(Markdown formatÄ±nda:\nbaÅŸlÄ±klar, kod bloklarÄ±,\nlisteler)\nKaynak etiketi: "ğŸ“š RAG"

== Hata DurumlarÄ± ==

alt Groq API HatasÄ±
    API --> Chat : {reply: "Åu an yanÄ±t veremiyorum...",\nsource: "fallback"}
    Chat -> User : Fallback mesajÄ± gÃ¶ster\nKaynak: "âš ï¸ Fallback"

else RAG SonuÃ§ BulunamadÄ±
    API -> Groq : Genel soru olarak gÃ¶nder\n(context olmadan)
    Groq --> API : Genel AI cevabÄ±
    API --> Chat : {reply: "...",\nsource: "ai"}
    Chat -> User : AI cevabÄ±nÄ± gÃ¶ster\nKaynak: "ğŸ¤– AI"
end

== Devam Eden Sohbet ==

User -> Chat : Takip sorusu:\n"useState ve useEffect farkÄ±?"
Chat -> API : POST /api/chat\n{message: "...",\nhistory: [Ã¶nceki 2 mesaj],\ncurrent_track_id: "frontend_developer"}
activate API
note right of API: AynÄ± RAG + Groq akÄ±ÅŸÄ±\ntekrar Ã§alÄ±ÅŸÄ±r\n(conversation history ile\ncontext korunur)
API --> Chat : ChatResponse
deactivate API
Chat -> User : CevabÄ± gÃ¶ster

deactivate Chat

@enduml
